
@{
    ViewData["Title"] = "Address";
}

<h1>JSON 縣市下拉式選單</h1>

<select id="idselect1">請選擇...</select>
<select id="idselect2">請縣市...</select>
<select id="idselect3">請鄉鎮...</select>

@section Styles
{
    <style>
    </style>
}

@section Scripts
{
    <script>

        const select1 = document.getElementById("idselect1");
        const select2 = document.getElementById("idselect2");
        const select3 = document.getElementById("idselect3");



        (async () => {
            const response = await fetch('@Url.Content("~/api/city")');
            const data = await response.json();
            const citys = data.map(city => `<option value="${city}">${city}</option>`);
            select1.innerHTML += `<option >請選擇...</option>`;
            select1.innerHTML += citys.join("");
        })();

        function add2 () {
            select2.innerHTML = "";
            select3.innerHTML = "";
            select3.innerHTML += `<option >請選擇...</option>`;
            //備註: 選擇的值 語法:
            // console.log(select.selectedIndex);
            // console.log(select.options[select.selectedIndex].value);
            // console.log(select.options[select.selectedIndex].text);

            (async () => {
            const pickedcity = select1.options[select1.selectedIndex].value;
                const url = `@Url.Content("~/api/District")?city=${pickedcity}`;
                const response = await fetch(url)
                const data = await response.json()
                const cityss = data.map((b) => {
                    let bb = b.substring(3, 6);
                    return `<option value="${b}">${bb}</option>`
                })
                select2.innerHTML += `<option >請選擇...</option>`;
                select2.innerHTML += cityss.join("");
            })();
        }

        function add3() {
            select3.innerHTML = "";
            console.log("add3");
            (async () => {
                const y = select2.options[select2.selectedIndex].value;
                console.log(y);
                const url = `@Url.Content("~/api/road")?district=${y}`;
                console.log(url);
                const response = await fetch(url)
                const data = await response.json()
                const citysss = data.map(c=>`<option value="${c}">${c}</option>`)
                select3.innerHTML += `<option >請選擇...</option>`;
                select3.innerHTML += citysss.join("");
            })();

        }

        select1.addEventListener("change", add2);
        select2.addEventListener("change", add3);
   </script>
}